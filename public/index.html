<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>GymRhythm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

  <!-- Intro.js (الدليل المرئي) -->
  <link href="https://cdn.jsdelivr.net/npm/intro.js/minified/introjs.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/intro.js/minified/intro.min.js"></script>

  <style>
    /* ============ لوح الألوان عبر متغيرات CSS ============ */
    :root{
      /* ألوان الثيم الافتراضي (Slate داكن) */
      --bg:        #0f172a;
      --surface:   #111827;
      --card:      #1f2937;
      --text:      #e2e8f0;
      --muted:     #94a3b8;
      --border:    #243041;
      --accent:    #2563eb;

      /* ألوان الأحداث/الرسم */
      --event-on:   #60a5fa;  /* أزرق */
      --event-off:  #64748b;  /* رمادي */
      --event-done: #22c55e;  /* أخضر */
    }

    /* رمادي Word (مستوحى من "Dark Gray" في أوفيس) */
    body.theme-gray{
      --bg:      #2b2b2b;
      --surface: #2f2f2f;
      --card:    #3a3a3a;
      --text:    #f0f0f0;
      --muted:   #cfcfcf;
      --border:  #4a4a4a;
      --accent:  #2ea3ff;

      --event-on:   #7db7ff;
      --event-off:  #8a8f98;
      --event-done: #34d399;
    }

    /* أوف-وايت فاتح هادئ */
    body.theme-offwhite{
      --bg:      #f5f6f7;
      --surface: #ffffff;
      --card:    #ffffff;
      --text:    #111827;
      --muted:   #4b5563;
      --border:  #e5e7eb;
      --accent:  #2563eb;

      --event-on:   #3b82f6;
      --event-off:  #9ca3af;
      --event-done: #10b981;
    }

    /* ============ تطبيق الألوان ============ */
    html, body{ height:100%; }
    body{ background:var(--bg); color:var(--text); }
    .navbar{ background:var(--surface); }
    .card{ background:var(--card); color:var(--text); border-radius:14px; border:1px solid var(--border); }
    .nav-link{ color:var(--text); }
    .nav-link.active{ background:#374151; border-color:var(--border); }
    .form-control, .form-select, .btn, .list-group-item{
      background:#fff; color:#111; border-color:var(--border);
    }
    .list-group-item{ background: #0b1220; color: var(--text); } /* تُستبدل تلقائياً في الثيمات الفاتحة */
    body.theme-offwhite .list-group-item{ background:#f3f4f6; color:#111; }

    /* FullCalendar عنوان */
    .fc .fc-toolbar-title{ font-size:1.1rem; }

    /* Legend
    .legend-dot{display:inline-block;width:12px;height:12px;border-radius:50%;margin-inline-end:6px}
    .legend-item{margin-inline-end:12px}
    .legend-dot.on   { background: var(--event-on); }
    .legend-dot.off  { background: var(--event-off); }
    .legend-dot.done { background: var(--event-done); } */


    /* زر المساعدة العائم */
    #helpFab{
      position: fixed; inset-inline-end: 16px; inset-block-end: 16px;
      z-index: 1055; border-radius: 999px; padding: 10px 14px;
      background:var(--accent); color:#fff; border:0; box-shadow: 0 6px 20px rgba(0,0,0,.35);
    }

    /* Intro.js (يمشي مع الثيم) */
    .introjs-tooltip { background:var(--surface); color:var(--text); border:1px solid var(--border); }
    .introjs-tooltipbuttons .introjs-button { background:var(--accent); color:#fff; border:0; }
    .introjs-button.introjs-prevbutton { background:#374151; }
    .introjs-helperLayer { box-shadow: 0 0 0 9999px rgba(0,0,0,.55); }
    .introjs-overlay { background: rgba(0,0,0,.55); }
    .introjs-progress { background:#374151; }
    .introjs-progressbar { background:var(--accent) !important; }
  </style>
</head>
<body class="theme-slate">
<nav class="navbar navbar-dark px-3">
  <span class="navbar-brand mb-0 h1">GymRhythm</span>

  <!-- اختيار الثيم -->
  <div class="ms-auto d-flex align-items-center gap-2">
    <label class="small me-1">السِّمة:</label>
    <select id="themeSelect" class="form-select form-select-sm" style="width:180px">
      <option value="theme-slate">Slate (داكن)</option>
      <option value="theme-gray">رمادي Word</option>
      <option value="theme-offwhite">أوف-وايت فاتح</option>
    </select>
  </div>
</nav>

<div class="container my-3">
  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3" id="mainTabs" role="tablist" data-intro="هنا تتنقل بين لوحة المتابعة، الإجراءات السريعة، ومعرض التقدّم.">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-dashboard" data-bs-toggle="tab"
              data-bs-target="#pane-dashboard" type="button" role="tab">لوحة المتابعة</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-quick" data-bs-toggle="tab"
              data-bs-target="#pane-quick" type="button" role="tab">إجراءات سريعة</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-gallery" data-bs-toggle="tab"
              data-bs-target="#pane-gallery" type="button" role="tab">معرض التقدّم</button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- لوحة المتابعة -->
    <div class="tab-pane fade show active" id="pane-dashboard" role="tabpanel">
      <div class="row g-3">
        <div class="col-lg-4 order-lg-1 order-2">
          <div class="card p-3" id="statsCard" data-intro="إحصاءات سريعة: عدد أيام On/Off وعدد الأيام المُنجزة آخر 30 يوم.">
            <h5 class="mb-2">إحصاءات</h5>
            <!-- <div class="mb-2 small">
              <span class="legend-item"><span class="legend-dot on"></span>On</span>
              <span class="legend-item"><span class="legend-dot off"></span>Off</span>
              <span class="legend-item"><span class="legend-dot done"></span>تم التنفيذ</span>
            </div> -->
            <canvas id="statsCanvas" height="180"></canvas>
          </div>
        </div>
        <div class="col-lg-8 order-lg-2 order-1">
          <div class="card p-3" id="calendarCard"
               data-intro="التقويم يعرض الخطة. انقر على يوم لفتح الضبط، أو انقر على الحدث نفسه للتبديل إلى &quot;تم التنفيذ&quot; ✓.">
            <div id="calendar"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- إجراءات سريعة -->
    <div class="tab-pane fade" id="pane-quick" role="tabpanel">
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="card p-3 mb-3" id="genCard" data-intro="ولّد خطة الشهر (On/Off بالتناوب).">
            <h5 class="mb-2">توليد شهر On/Off</h5>
            <div class="row g-2">
              <div class="col-4"><input id="year" class="form-control form-control-sm" type="number" value="2025"></div>
              <div class="col-4"><input id="month" class="form-control form-control-sm" type="number" value="9"></div>
              <div class="col-4 form-check mt-1">
                <input id="startOn" class="form-check-input" type="checkbox" checked>
                <label class="form-check-label" data-bs-toggle="tooltip" title="ابدأ بالسطر الأول كـ On">ابدأ بـ On</label>
              </div>
            </div>
            <button id="btnGenerate" class="btn btn-light btn-sm mt-2" data-bs-toggle="tooltip" title="ينشئ/يحدّث الأيام للشهر المختار">توليد الجدول</button>
            <div id="genMsg" class="small mt-2"></div>
          </div>

          <div class="card p-3" id="quickLogCard" data-intro="سجّل إنجاز يوم بسرعة.">
            <h5 class="mb-2">تسجيل تنفيذ اليوم</h5>
            <div class="row g-2">
              <div class="col-6"><input id="logDate" type="date" class="form-control form-control-sm"></div>
              <div class="col-6"><input id="logNote" type="text" class="form-control form-control-sm" placeholder="ملاحظة"></div>
            </div>
            <button id="btnLog" class="btn btn-light btn-sm mt-2">تسجيل ✓</button>
            <div id="logMsg" class="small mt-2"></div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card p-3" id="uploadCard" data-intro="ارفع صورة تقدّم.">
            <h5 class="mb-2">رفع صورة التقدّم</h5>
            <input id="photoFile" type="file" accept="image/*" class="form-control form-control-sm">
            <button id="btnSavePhoto" class="btn btn-light btn-sm mt-2">حفظ الصورة</button>
            <div id="photoMsg" class="small mt-2"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- معرض التقدّم -->
    <div class="tab-pane fade" id="pane-gallery" role="tabpanel">
      <div class="row g-3">
        <div class="col-lg-3">
          <div class="card p-3" id="groupsCard" data-intro="أنشئ مجموعات (Bulk/Cut...). اسحب صورة على المجموعة لإسنادها.">
            <h6 class="mb-2">المجموعات</h6>
            <div class="input-group input-group-sm mb-2">
              <input id="grpName" class="form-control" placeholder="اسم المجموعة">
              <button id="btnAddGroup" class="btn btn-light">إضافة</button>
            </div>
            <ul id="groupsList" class="list-group small"></ul>
          </div>
        </div>
        <div class="col-lg-9">
          <div class="card p-3" id="galleryCard" data-intro="اختر صورتين (Checkbox) ثم &quot;مقارنة صورتين&quot;.">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="m-0">الصور</h6>
              <button id="btnCompare" class="btn btn-outline-light btn-sm" disabled>مقارنة صورتين</button>
            </div>
            <div id="galleryGrid" class="row g-2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal: ضبط يوم -->
<div class="modal fade" id="dayModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content" style="background:var(--card);color:var(--text);border:1px solid var(--border)">
      <div class="modal-header"><h5 class="modal-title">ضبط اليوم</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <div class="mb-2"><input id="dayDate" type="text" class="form-control" disabled></div>
        <div class="mb-2">
          <label class="form-label">الخطة</label>
          <select id="dayPlan" class="form-select">
            <option>On</option><option>Off</option>
            <option>Legs</option><option>Push</option><option>Pull</option>
            <option>Chest</option><option>Back</option><option>Shoulders</option>
          </select>
        </div>
        <div class="form-text">انقر الحدث في التقويم لتبديل “تم التنفيذ”.</div>
      </div>
      <div class="modal-footer">
        <button id="saveDay" class="btn btn-light btn-sm">حفظ</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal: مقارنة قبل/بعد -->
<div class="modal fade" id="compareModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="background:var(--card);color:var(--text);border:1px solid var(--border)">
      <div class="modal-header"><h5 class="modal-title">مقارنة قبل/بعد</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <div id="compareWrap" style="position:relative;max-width:100%;overflow:hidden"></div>
      </div>
    </div>
  </div>
</div>

<!-- زر المساعدة العائم -->
<button id="helpFab" title="دليل سريع (F1)">؟</button>

<script src="./app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
